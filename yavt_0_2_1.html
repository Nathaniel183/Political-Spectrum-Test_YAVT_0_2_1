<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>YAVT 0.2.1 — 本地测试页</title>
  <style>
    :root{
      --bg: #ffffff;
      --card: #f6f4f3;
      --text: #2e2a28;
      --muted: #7b746f;
      --accent-1: #a96f6f; /* 莫兰迪偏红 */
      --accent-2: #b28787;
      --accent-3: #d7c6c6;
      --green: #7aa57a;
      --shadow: 0 6px 18px rgba(46,42,40,0.06);
      font-family: -apple-system, BlinkMacSystemFont, "Helvetica Neue", "PingFang SC", "Hiragino Sans GB", "Microsoft Yahei", "Arial", sans-serif;
    }

    html,body{height:100%;background:var(--bg);color:var(--text);margin:0;padding:0}
    .app{max-width:540px;margin:0 auto;min-height:100vh;display:flex;flex-direction:column}

    header{padding:18px 16px 6px}
    .container{padding:12px;flex:1;display:flex;flex-direction:column;gap:12px}

    .card{background:var(--card);border-radius:14px;padding:14px;box-shadow:var(--shadow)}
    h1{font-size:18px;margin:0 0 8px}
    p.lead{margin:0;color:var(--muted);font-size:14px}

    /* Start screen */
    .start-cta{display:flex;flex-direction:column;gap:12px;align-items:stretch}
    .btn{display:inline-flex;align-items:center;justify-content:center;padding:12px 16px;border-radius:12px;border:none;background:var(--accent-1);color:white;font-weight:600;font-size:15px}
    .btn.ghost{background:transparent;color:var(--accent-1);border:1px solid rgba(169,111,111,0.12)}

    /* Quiz */
    .question-area{display:flex;flex-direction:column;gap:12px}
    .q-text{font-size:16px;line-height:1.45}
    .choices{display:flex;flex-direction:column;gap:8px}
    .choice{display:flex;align-items:center;gap:12px;padding:10px;border-radius:10px;background:white;border:1px solid rgba(16,16,16,0.03)}
    .choice input{accent-color:var(--accent-1)}
    .progress{height:6px;background:linear-gradient(90deg, var(--accent-3), #f0efef);border-radius:999px;overflow:hidden}
    .progress > i{display:block;height:100%;background:linear-gradient(90deg,var(--accent-2),var(--accent-1));width:0%}

    .nav{display:flex;gap:8px;align-items:center}
    .small{font-size:13px;color:var(--muted)}

    /* Result */
    .axis{display:flex;flex-direction:column;gap:8px;padding:12px;border-radius:12px;background:white}
    .axis .row{display:flex;align-items:center;justify-content:space-between}
    .axis .bar{height:12px;background:#f0efef;border-radius:999px;position:relative;overflow:hidden;margin-top:6px}
    .axis .bar > .fill{position:absolute;left:0;top:0;height:100%;border-radius:999px;background:linear-gradient(90deg,var(--accent-3),var(--accent-1));}
    .axis .labels{display:flex;justify-content:space-between;font-size:13px;color:var(--muted);margin-top:8px}
    .axis .explain{font-weight:600;color:var(--accent-1);font-size:14px}

    footer{padding:12px;text-align:center}

    /* Responsive tweaks */
    @media(min-width:640px){.app{padding:12px 0}}

  </style>
</head>
<body>
  <div class="app">
    <header>
      <h1>YAVT 0.2.1 — 政治倾向测试（本地版）</h1>
      <p class="lead">在中国环境下作答：请根据你在中国语境中的观点选择最符合的一项。</p>
    </header>

    <main class="container">

      <!-- Start Screen -->
      <section id="start" class="card">
        <div style="display:flex;flex-direction:column;gap:12px">
          <div>
            <strong>说明</strong>
            <p class="small">本测试基于 YAVT 0.2.1（5 轴）。每题 5 个选项：强烈同意 / 同意 / 中立 / 反对 / 强烈反对。测试在本地计算，不会上传到网络。</p>
          </div>
          <div class="start-cta">
            <button class="btn" onclick="startQuiz()">开始测试</button>
            <button class="btn ghost" onclick="showGuide()">如何作答（示例）</button>
          </div>
        </div>
      </section>

      <!-- Quiz Screen -->
      <section id="quiz" style="display:none;flex-direction:column;gap:12px">
        <div class="card question-area">
          <div class="row" style="display:flex;justify-content:space-between;align-items:center">
            <div class="small" id="q-index">第 1 / 0 题</div>
            <div style="display:flex;gap:8px;align-items:center">
              <div class="small" id="q-progress-text">0%</div>
            </div>
          </div>

          <div class="progress" aria-hidden>
            <i id="q-progress" style="width:0%"></i>
          </div>

          <div>
            <div class="q-text" id="q-text">问题文本</div>
          </div>

          <form id="choices" class="choices" onsubmit="return false;">
            <label class="choice"><input type="radio" name="answer" value="SA"> <div>强烈同意</div></label>
            <label class="choice"><input type="radio" name="answer" value="A">  <div>同意</div></label>
            <label class="choice"><input type="radio" name="answer" value="N">  <div>中立（不确定）</div></label>
            <label class="choice"><input type="radio" name="answer" value="D">  <div>反对</div></label>
            <label class="choice"><input type="radio" name="answer" value="SD"> <div>强烈反对</div></label>
          </form>

          <div class="nav">
            <button class="btn ghost" id="prevBtn" onclick="prevQ()" style="flex:1">上一步</button>
            <button class="btn" id="nextBtn" onclick="nextQ()" style="flex:1">下一步</button>
          </div>
        </div>
      </section>

      <!-- Results -->
      <section id="result" style="display:none;flex-direction:column;gap:12px">
        <div class="card">
          <div style="display:flex;justify-content:space-between;align-items:center">
            <div>
              <strong>测试结果</strong>
              <div class="small">五个维度的得分（数值 0 - 100）及对应标签</div>
            </div>
            <div style="text-align:right">
              <button class="btn ghost" onclick="restart()">重新测试</button>
            </div>
          </div>

          <div id="axes" style="display:flex;flex-direction:column;gap:12px;margin-top:12px"></div>

          <div style="margin-top:12px;padding:12px;border-radius:10px;background:#fff7f7">
            <div class="small">最接近的意识形态</div>
            <div id="best-ideo" style="font-weight:800;font-size:18px;margin-top:6px;color:var(--accent-1)"></div>
          </div>
        </div>
      </section>

    </main>

    <footer>
      <div class="small">本页面为本地离线实现，数据和计算均在浏览器完成。</div>
    </footer>
  </div>

  <script>
  // 数据（questions + model）——已省略一些注释以便页面紧凑
  const MODEL = {
    name: "yavt-5-axis",
    dimensions: ["计划-市场","世界-国家","自由-权威","进步-守成","环保-发展"],
    dimensionsEn: ["FreeMarket-PlannedEconomy","Statism-Internationalism","Liberalism-Fascism","Progressivism-Conservatism","Environmentalism-AntiEnvironmentalism"],
    explanations: [
      ["共产主义","社会主义","偏向平等","中立","偏向市场","资本主义","自由放任"],
      ["世界主义","国际主义","偏向国际","中立","偏向本国","民族主义","沙文主义"],
      ["无政府主义","自由意志主义","偏向自由","中立","偏向专制","威权主义","极权主义"],
      ["变革","进步","偏向改良","中立","偏向保守","传统","反动"],
      ["深绿","生态主义","环保优先","中立","发展优先","生产主义","环保怀疑主义"]
    ],
    ideologies: {
      "无政府共产主义": [100,90,100,90,50],
      "自由意志社会主义": [80,80,90,80,50],
      "托洛茨基主义": [90,90,75,85,50],
      "列宁主义": [90,70,35,70,50],
      "马克思列宁主义": [90,40,20,50,50],
      "左翼民粹主义": [60,30,30,70,50],
      "社会民主主义": [65,65,65,80,50],
      "社会自由主义": [60,60,60,80,50],
      "自由主义": [50,60,60,60,50],
      "古典自由主义": [20,60,60,70,50],
      "新自由主义": [30,30,50,60,50],
      "保守主义": [30,40,40,20,50],
      "新保守主义": [20,20,40,20,50],
      "旧保守主义": [20,30,60,10,50],
      "右翼民粹主义": [40,30,30,30,50],
      "威权资本主义": [20,50,20,40,50],
      "新儒家": [50,30,25,10,50],
      "无政府资本主义": [40,20,20,20,50],
      "法西斯主义": [40,20,20,20,50],
      "纳粹主义": [40,0,0,5,50]
    }
  };

  // 问题列表（你提供的完整 JSON）
  const QUESTIONS = [
    {evaluation:[0,0,10,0,0],text:"面对公共危机事件，哪怕会引发民众恐慌骚乱，政府也不应该瞒报实情。"},
    {evaluation:[0,0,10,0,0],text:"即使面临人口膨胀或人口老龄化的压力，生不生、生多少小孩也是每个人的自由，政府与社会不应干涉。"},
    {evaluation:[0,-5,-5,0,0],text:"没有大国崛起，就没有小民尊严。"},
    {evaluation:[0,0,-10,-5,0],text:"将选举权交给乌合之众（群氓）是危险的，只有高素养公民才能参与政治。"},
    {evaluation:[0,0,10,0,0],text:"国家是对暴力和压迫的垄断，任何国家都应当立刻被废除。"},
    {evaluation:[0,0,-5,0,0],text:"西方多党制下相互扯皮，效率低下。"},
    {evaluation:[0,0,-10,0,0],text:"如果暴力示威者引发冲突骚乱，政府应当止暴制乱恢复秩序。"},
    {evaluation:[0,0,10,0,0],text:"政治领袖的形象可以作为文艺作品的丑化对象。"},
    {evaluation:[0,0,-10,0,0],text:"妄议时事、破坏社会稳定的言论应当封杀，制造者和传播者应当严惩。"},
    {evaluation:[0,-5,-5,0,0],text:"在一切国内公开场合（包括出版物）出现我国地图时，需要使用官方声明的正确主权版图。"},
    {evaluation:[0,0,10,0,0],text:"对文化产品的一切事先审查制度都应该取消。"},
    {evaluation:[0,0,-5,0,0],text:"将重要事务交给民众公投决定是政治精英不负责任的表现。"},
    {evaluation:[0,0,-10,0,0],text:"一个秩序井然的专制统治好于混乱暴力的动荡状态。"},
    {evaluation:[5,0,0,0,0],text:"关系到国家安全和国民经济命脉的行业必须国有。"},
    {evaluation:[-10,0,0,0,0],text:"任何税收都是对私有财产不可接受的侵犯。"},
    {evaluation:[-10,0,0,0,0],text:"高福利使人懈怠于工作。"},
    {evaluation:[10,0,0,0,0],text:"金融业、房地产业是社会的蛀虫。"},
    {evaluation:[-10,0,-5,0,0],text:"为了经济增长，可以默许一些对劳工权益的损害。"},
    {evaluation:[10,0,0,0,0],text:"教育和医疗等公共事业应当严格限制其私有化。"},
    {evaluation:[-10,0,0,0,0],text:"有钱人可以用金钱购买更好的教育和医疗等服务。"},
    {evaluation:[10,0,0,0,0],text:"没有政府干预，市场是不可能存在的。"},
    {evaluation:[10,0,0,0,0],text:"雇佣劳动是资本家对劳动者的剥削和奴役。"},
    {evaluation:[-10,0,0,0,0],text:"不应当打击市场经济中自然形成的垄断。"},
    {evaluation:[-10,0,0,0,0],text:"亏损国企与其继续亏损，不如私有化卖给资本家。"},
    {evaluation:[10,0,0,0,0],text:"底层民众深受经济全球化所害。"},
    {evaluation:[10,0,0,0,0],text:"生产资料私有制应当被废除。"},
    {evaluation:[-10,0,0,0,0],text:"只要员工同意，企业就有权延长工作时间。"},
    {evaluation:[0,0,0,10,0],text:"政府和社会无权干涉成年人之间自愿且安全的性行为，不管其婚姻关系如何。"},
    {evaluation:[0,0,0,5,0],text:"父母不应当干涉子女的婚嫁。"},
    {evaluation:[0,0,0,10,0],text:"同性伴侣婚姻应当合法化。"},
    {evaluation:[0,0,0,-10,0],text:"中华道德传统对当今社会总体利大于弊。"},
    {evaluation:[0,0,0,10,0],text:"婚姻制度应当被废除。"},
    {evaluation:[0,0,0,10,0],text:"律师即使明知被辩护人的犯罪事实也应当尽力为其进行辩护。"},
    {evaluation:[0,0,0,-10,0],text:"与现代主流医学相比，我国传统医学更值得信任。"},
    {evaluation:[0,0,0,-10,0],text:"当法律未能充分制止罪恶行为时，人民群众有权自发对罪恶行为进行制裁。"},
    {evaluation:[0,0,0,-10,0],text:"女子无才便是德。"},
    {evaluation:[0,0,0,-5,0],text:"我通常听从长辈的意见，因为他们的阅历丰富，尽管这违背了我原本的意愿。"},
    {evaluation:[0,0,0,10,0],text:"司法判决不应当受民意或舆论压力影响。"},
    {evaluation:[0,0,0,-10,0],text:"现在女性的地位已经大大高于男性，女权主义应当被遏制。"},
    {evaluation:[0,5,0,0,0],text:"我国应当援助有困难的国家。"},
    {evaluation:[0,-10,-10,0,0],text:"国家统一和领土完整高于一切。"},
    {evaluation:[0,-10,0,0,0],text:"没有祖国，你什么都不是。"},
    {evaluation:[0,-10,0,0,0],text:"我国应使用一切可能的手段来维护国家利益。"},
    {evaluation:[5,-5,0,0,0],text:"我国的工业体系必须独立自主，重要行业一定要掌握在国人手里。"},
    {evaluation:[0,-10,0,0,0],text:"中美冲突本质是中华文明和西方文明的冲突。"},
    {evaluation:[0,-5,0,0,0],text:"学校应当对学生进行爱国主义教育。"},
    {evaluation:[0,10,0,0,0],text:"国家和地区的边界终究要被废除。"},
    {evaluation:[0,-10,0,0,0],text:"族群之间存在天生的勤劳、聪明程度等的优劣差异。"},
    {evaluation:[0,10,0,0,0],text:"在我国永居的外国人应当拥有与本国公民同等的政治权利。"},
    {evaluation:[0,0,0,0,-10],text:"人为造成的全球气候变化根本不存在，全球变暖是个骗局。"},
    {evaluation:[-5,0,0,0,-10],text:"为了快速发展经济，“先污染后治理”是可取的。"},
    {evaluation:[0,0,0,0,10],text:"对于人类整体而言，全球变暖是迫在眉睫的威胁。"},
    {evaluation:[0,0,0,0,10],text:"为了环保，我可以接受使用清洁能源造成的生活成本大幅增加。"},
    {evaluation:[5,0,0,0,10],text:"即使会影响经济效益，政府也应该对企业执行更严格的环境影响评估。"},
    {evaluation:[0,0,0,0,10],text:"因人类行为而造成的物种灭绝是不可容忍的，我们应当竭尽全力阻止这种事的发生。"},
    {evaluation:[0,5,0,0,10],text:"哪怕其他国家没有完成，我国仍要实现在国际减排合约上的承诺。"}
  ];

  // 答案权重映射
  const VOTE_MAP = {SA:1.0,A:0.5,N:0.0,D:-0.5,SD:-1.0};

  // runtime state
  let answers = new Array(QUESTIONS.length).fill(null);
  let cur = 0;

  function showGuide(){
    alert('示例：\n\n强烈同意 / 同意 / 中立 / 反对 / 强烈反对 分别对应权重 +1 / +0.5 / 0 / -0.5 / -1 。\n\n请按照你在中国语境下的真实想法作答。');
  }

  function startQuiz(){
    document.getElementById('start').style.display='none';
    document.getElementById('quiz').style.display='flex';
    document.getElementById('result').style.display='none';
    cur = 0; answers = new Array(QUESTIONS.length).fill(null);
    renderQuestion();
  }

  function renderQuestion(){
    const q = QUESTIONS[cur];
    document.getElementById('q-text').textContent = q.text;
    document.getElementById('q-index').textContent = `第 ${cur+1} / ${QUESTIONS.length} 题`;
    const percent = Math.round(((cur+1)/QUESTIONS.length)*100);
    document.getElementById('q-progress-text').textContent = percent + '%';
    document.getElementById('q-progress').style.width = percent + '%';

    // fill choices
    const form = document.getElementById('choices');
    const radios = form.elements['answer'];
    if(radios){
      for(let r of radios) r.checked = false;
    }
    if(answers[cur]){
      const val = answers[cur];
      for(let r of radios) if(r.value===val) r.checked = true;
    }

    // prev/next enable
    document.getElementById('prevBtn').disabled = (cur===0);
    document.getElementById('nextBtn').textContent = (cur===QUESTIONS.length-1)?'完成':'下一步';
  }

  function nextQ(){
    const form = document.getElementById('choices');
    const radios = form.elements['answer'];
    let picked = null;
    for(let r of radios) if(r.checked) picked = r.value;
    if(!picked){
      alert('请选择一项后继续（可选 中立）。');
      return;
    }
    answers[cur] = picked;
    if(cur < QUESTIONS.length -1){ cur++; renderQuestion(); }
    else { finish(); }
  }
  function prevQ(){
    if(cur>0){ cur--; renderQuestion(); }
  }

  function restart(){
    document.getElementById('start').style.display='block';
    document.getElementById('quiz').style.display='none';
    document.getElementById('result').style.display='none';
  }

  function finish(){
    // compute raw axis scores
    const axes = MODEL.dimensions.length;
    const raw = new Array(axes).fill(0);
    const maxAbs = new Array(axes).fill(0);

    // compute max absolute sum per axis
    for(let q of QUESTIONS){
      for(let i=0;i<axes;i++){
        maxAbs[i] += Math.abs(q.evaluation[i]||0);
      }
    }

    // accumulate weighted answers
    for(let i=0;i<QUESTIONS.length;i++){
      const ans = answers[i] || 'N';
      const mult = VOTE_MAP[ans] || 0;
      const ev = QUESTIONS[i].evaluation;
      for(let j=0;j<axes;j++) raw[j] += (ev[j]||0) * mult;
    }

    // normalize to 0-100 using formula: 50 + (raw / maxAbs) * 50
    const percents = new Array(axes).fill(50);
    for(let j=0;j<axes;j++){
      if(maxAbs[j] <= 0){ percents[j] = 50; continue; }
      let v = 50 + (raw[j] / maxAbs[j]) * 50;
      v = Math.round(Math.max(0, Math.min(100, v)));
      percents[j] = v;
    }

    // compute explanation label per axis
    const explanations = [];
    for(let j=0;j<axes;j++){
      const labels = MODEL.explanations[j];
      const idx = Math.round((percents[j]/100) * (labels.length - 1));
      explanations.push(labels[idx]);
    }

    // compute nearest ideology via Euclidean distance
    let best = null; let bestDist = Infinity;
    for(const [name, vec] of Object.entries(MODEL.ideologies)){
      let d2 = 0;
      for(let j=0;j<axes;j++){
        const diff = (percents[j]||50) - (vec[j]||50);
        d2 += diff*diff;
      }
      if(d2 < bestDist){ bestDist = d2; best = name; }
    }

    // render results
    renderResults(percents, explanations, best);
  }

  function renderResults(percs, explains, best){
    document.getElementById('quiz').style.display='none';
    const axesWrap = document.getElementById('axes');
    axesWrap.innerHTML='';
    for(let j=0;j<MODEL.dimensions.length;j++){
      const axisName = MODEL.dimensions[j];
      const leftRight = axisName.split('-');
      const left = leftRight[0]||''; const right = leftRight[1]||'';
      const p = percs[j];
      const expl = explains[j];

      const div = document.createElement('div'); div.className='axis';
      div.innerHTML = `
        <div class="row"><div class="explain">${expl}</div><div style="font-weight:800">${p}%</div></div>
        <div class="labels" style="margin-top:8px"><div class="small">${left}</div><div class="small">${right}</div></div>
        <div class="bar"><div class="fill" style="width:${p}%"></div></div>
      `;
      axesWrap.appendChild(div);
    }

    document.getElementById('best-ideo').textContent = best || '——';
    document.getElementById('result').style.display='flex';
    // scroll into view on small screens
    setTimeout(()=>{ document.getElementById('result').scrollIntoView({behavior:'smooth'}); },120);
  }

  // allow keyboard nav on mobile
  document.addEventListener('keydown', (e)=>{
    if(document.getElementById('quiz').style.display!=='none'){
      if(e.key==='ArrowRight') nextQ();
      if(e.key==='ArrowLeft') prevQ();
    }
  });
  </script>
</body>
</html>